<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weapon System Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .weapon-slot {
            width: 200px;
            height: 100px;
            border: 2px solid #555;
            border-radius: 8px;
            padding: 10px;
            margin: 10px;
            cursor: pointer;
            background: #2a2a2a;
        }
        .weapon-display {
            text-align: center;
        }
        .weapon-icon {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
        }
        .weapon-name {
            margin-top: 5px;
            font-size: 14px;
        }
        .weapon-dropdown {
            display: none;
            position: absolute;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 10px;
            z-index: 1000;
        }
        .weapon-dropdown.show {
            display: block;
        }
        .weapon-option {
            display: flex;
            align-items: center;
            padding: 5px;
            margin: 2px 0;
            cursor: pointer;
            border-radius: 4px;
        }
        .weapon-option:hover {
            background: #444;
        }
        .weapon-option.locked {
            opacity: 0.4;
        }
        .weapon-option-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
        .debug-info {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>üî´ Weapon System Debug</h1>
    
    <div class="debug-info">
        <h3>Debug Controls</h3>
        <button onclick="testWeaponSelection('pistol')">Select Pistol</button>
        <button onclick="testWeaponSelection('shotgun')">Select Shotgun</button>
        <button onclick="testWeaponSelection('ar')">Select AR</button>
        <button onclick="testWeaponSelection('sniper')">Select Sniper</button>
        <button onclick="toggleDropdown()">Toggle Dropdown</button>
        <button onclick="showDebugInfo()">Show Debug Info</button>
    </div>

    <div class="weapon-slot" data-current-weapon="pistol" onclick="toggleDropdown()">
        <div class="weapon-display">
            <img src="src/sprites/guns/img/pistol.png" alt="–ü–∏—Å—Ç–æ–ª–µ—Ç" class="weapon-icon" id="current-weapon-icon">
            <div class="weapon-name" id="current-weapon-name">–ü–∏—Å—Ç–æ–ª–µ—Ç</div>
        </div>
        <div class="weapon-dropdown" id="weapon-dropdown">
            <div class="weapon-option" data-weapon="pistol" onclick="selectWeapon('pistol')">
                <img src="src/sprites/guns/img/pistol.png" alt="–ü–∏—Å—Ç–æ–ª–µ—Ç" class="weapon-option-icon">
                <span>–ü–∏—Å—Ç–æ–ª–µ—Ç</span>
            </div>
            <div class="weapon-option locked" data-weapon="shotgun" onclick="selectWeapon('shotgun')">
                <img src="src/sprites/guns/img/shotgun.png" alt="–î—Ä–æ–±–æ–≤–∏–∫" class="weapon-option-icon">
                <span>–î—Ä–æ–±–æ–≤–∏–∫</span>
            </div>
            <div class="weapon-option locked" data-weapon="assault_rifle" onclick="selectWeapon('assault_rifle')">
                <img src="src/sprites/guns/img/assault_rifle.png" alt="–®—Ç—É—Ä–º–æ–≤–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞" class="weapon-option-icon">
                <span>–®—Ç—É—Ä–º–æ–≤–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞</span>
            </div>
            <div class="weapon-option locked" data-weapon="sniper_rifle" onclick="selectWeapon('sniper_rifle')">
                <img src="src/sprites/guns/img/sniper_rifle.png" alt="–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞" class="weapon-option-icon">
                <span>–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞</span>
            </div>
        </div>
    </div>

    <div class="debug-info">
        <h3>Current State</h3>
        <div id="debug-output">Loading...</div>
    </div>

    <script>
        // Weapon system state
        let currentWeapon = 'pistol';
        let weaponDropdownVisible = false;

        // Mock abilities data
        const mockAbilitiesData = {
            learnedAbilities: ['def_shotgun', 'def_assault_rifle']
        };

        // Weapon data
        function getWeaponData(weaponType) {
            const weaponData = {
                'pistol': {
                    name: '–ü–∏—Å—Ç–æ–ª–µ—Ç',
                    ability: null,
                    damage: 1,
                    ammoCost: 1
                },
                'shotgun': {
                    name: '–î—Ä–æ–±–æ–≤–∏–∫',
                    ability: 'def_shotgun',
                    damage: 2,
                    ammoCost: 1
                },
                'ar': {
                    name: '–®—Ç—É—Ä–º–æ–≤–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞',
                    ability: 'def_assault_rifle',
                    damage: 1,
                    ammoCost: 1,
                    description: '–ö–ª–∏–∫ - –æ–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª, —É–¥–µ—Ä–∂–∏–≤–∞–Ω–∏–µ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–≥–æ–Ω—å (3 –≤—ã—Å—Ç—Ä–µ–ª–∞/—Å–µ–∫)'
                },
                'sniper': {
                    name: '–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞',
                    ability: 'def_sniper_rifle',
                    damage: 3,
                    ammoCost: 1
                }
            };
            return weaponData[weaponType] || weaponData['pistol'];
        }

        function getWeaponDisplayName(weaponType) {
            return getWeaponData(weaponType).name;
        }

        function isWeaponAvailable(weaponType) {
            const weaponData = getWeaponData(weaponType);

            // Basic weapons are always available
            if (!weaponData.ability) return true;

            // Check if ability is learned
            return mockAbilitiesData.learnedAbilities.includes(weaponData.ability);
        }

        function updateWeaponDisplay() {
            const icon = document.getElementById('current-weapon-icon');
            const name = document.getElementById('current-weapon-name');
            const weaponSlot = document.querySelector('.weapon-slot');

            if (icon && name && weaponSlot) {
                const weaponData = getWeaponData(currentWeapon);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ä—É–∂–∏—è
                let imageSrc;
                switch (currentWeapon) {
                    case 'pistol':
                        imageSrc = 'src/sprites/guns/img/pistol.png';
                        break;
                    case 'shotgun':
                        imageSrc = 'src/sprites/guns/img/shotgun.png';
                        break;
                    case 'ar':
                        imageSrc = 'src/sprites/guns/img/assault_rifle.png';
                        break;
                    case 'sniper':
                        imageSrc = 'src/sprites/guns/img/sniper_rifle.png';
                        break;
                    default:
                        imageSrc = 'src/sprites/guns/img/pistol.png';
                }
                
                icon.src = imageSrc;
                icon.alt = weaponData.name;
                name.textContent = weaponData.name;
                weaponSlot.setAttribute('data-current-weapon', currentWeapon);
                
                console.log(`[updateWeaponDisplay] Updated weapon display to: ${currentWeapon} (${weaponData.name})`);
            } else {
                console.warn('[updateWeaponDisplay] Required elements not found:', {
                    icon: !!icon,
                    name: !!name,
                    weaponSlot: !!weaponSlot
                });
            }
        }

        function updateWeaponAvailability() {
            const weaponOptions = document.querySelectorAll('.weapon-option');
            weaponOptions.forEach(option => {
                const weaponType = option.dataset.weapon;
                if (weaponType) {
                    const available = isWeaponAvailable(weaponType);
                    option.classList.toggle('locked', !available);
                    option.classList.toggle('available', available);
                    
                    console.log(`[updateWeaponAvailability] Weapon ${weaponType}: ${available ? 'available' : 'locked'}`);
                }
            });
        }

        function toggleDropdown() {
            const dropdown = document.getElementById('weapon-dropdown');
            if (!dropdown) {
                console.warn('[toggleDropdown] Weapon dropdown not found');
                return;
            }

            weaponDropdownVisible = !weaponDropdownVisible;
            console.log(`[toggleDropdown] Toggling dropdown visibility to: ${weaponDropdownVisible}`);

            if (weaponDropdownVisible) {
                dropdown.classList.add('show');
                updateWeaponAvailability();
                console.log('[toggleDropdown] Dropdown shown and availability updated');
            } else {
                dropdown.classList.remove('show');
                console.log('[toggleDropdown] Dropdown hidden');
            }
        }

        function selectWeapon(weaponType) {
            console.log('[selectWeapon] Selecting weapon:', weaponType);

            // Check if weapon is available
            if (!isWeaponAvailable(weaponType)) {
                alert(`–û—Ä—É–∂–∏–µ "${getWeaponDisplayName(weaponType)}" –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ò–∑—É—á–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.`);
                return;
            }

            console.log(`[selectWeapon] Weapon ${weaponType} is available, proceeding with selection`);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –æ—Ä—É–∂–∏–µ
            currentWeapon = weaponType;
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
            toggleDropdown();

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            setTimeout(() => {
                updateWeaponDisplay();
                console.log(`[selectWeapon] Weapon display updated for: ${weaponType}`);
            }, 10);

            const weaponData = getWeaponData(weaponType);
            let message = `–í—ã–±—Ä–∞–Ω–æ –æ—Ä—É–∂–∏–µ: ${weaponData.name}`;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é –º–µ—Ö–∞–Ω–∏–∫—É –¥–ª—è —à—Ç—É—Ä–º–æ–≤–æ–π –≤–∏–Ω—Ç–æ–≤–∫–∏
            if (weaponType === 'ar' && weaponData.description) {
                message += `\n${weaponData.description}`;
            }

            alert(message);
            
            console.log(`[selectWeapon] Weapon selection completed for: ${weaponType}`);
        }

        function testWeaponSelection(weaponType) {
            console.log(`[testWeaponSelection] Testing weapon selection: ${weaponType}`);
            selectWeapon(weaponType);
        }

        function showDebugInfo() {
            const debugOutput = document.getElementById('debug-output');
            debugOutput.innerHTML = `
                <strong>Current Weapon:</strong> ${currentWeapon}<br>
                <strong>Weapon Name:</strong> ${getWeaponDisplayName(currentWeapon)}<br>
                <strong>Dropdown Visible:</strong> ${weaponDropdownVisible}<br>
                <strong>Weapon Available:</strong> ${isWeaponAvailable(currentWeapon)}<br>
                <strong>Weapon Data:</strong> ${JSON.stringify(getWeaponData(currentWeapon), null, 2)}<br>
                <strong>Learned Abilities:</strong> ${JSON.stringify(mockAbilitiesData.learnedAbilities)}<br>
            `;
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[Debug] Weapon system initialized');
            updateWeaponDisplay();
            updateWeaponAvailability();
            showDebugInfo();
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const weaponSlot = document.querySelector('.weapon-slot');
            const dropdown = document.getElementById('weapon-dropdown');

            if (weaponSlot && dropdown && !weaponSlot.contains(event.target)) {
                if (weaponDropdownVisible) {
                    weaponDropdownVisible = false;
                    dropdown.classList.remove('show');
                }
            }
        });
    </script>
</body>
</html>
