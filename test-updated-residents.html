<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест обновленного окна жителей</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
        }

        .test-btn {
            background: #2a2a2a;
            border: 2px solid #555555;
            color: #e0e0e0;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 10px;
            margin: 5px;
        }

        .test-btn:hover {
            background: #3a3a3a;
            border-color: #D4AF37;
        }

        .simple-list {
            background: #2a2a2a;
            border: 1px solid #444;
            padding: 15px;
            margin: 20px 0;
            font-size: 8px;
        }

        .simple-list h3 {
            color: #D4AF37;
            margin-top: 0;
        }

        .simple-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding: 8px;
            margin: 5px 0;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
        }

        .simple-name {
            font-size: 10px;
            font-weight: bold;
            color: #D4AF37;
        }

        .simple-profession {
            font-size: 8px;
            color: #e0e0e0;
        }

        .debug-info {
            background: #2a2a2a;
            border: 1px solid #444;
            padding: 15px;
            margin-top: 20px;
            font-size: 10px;
        }

        .debug-info h3 {
            color: #D4AF37;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <h1>Тест обновленного окна жителей</h1>

    <div>
        <button class="test-btn" onclick="testSimpleList()">Показать упрощенный список</button>
        <button class="test-btn" onclick="testOpenResidents()">Открыть окно жителей</button>
        <button class="test-btn" onclick="testOpenResidentDetail()">Показать детальную информацию</button>
        <button class="test-btn" onclick="closeAllModals()">❌ Закрыть все</button>
    </div>

    <div id="simple-list" class="simple-list" style="display: none;">
        <h3>Упрощенный список жителей</h3>
        <div id="simple-items"></div>
    </div>

    <div class="debug-info">
        <h3>Что изменилось</h3>
        <ul>
            <li>✅ Список жителей теперь показывает только имя и специальность</li>
            <li>✅ Упрощенный дизайн для мобильных устройств</li>
            <li>✅ Здоровье синхронизируется с реальным здоровьем из bunkerView</li>
            <li>✅ Добавлена функция getResidentById для получения свежих данных</li>
        </ul>
        <div id="status">Status: Ready</div>
    </div>

    <!-- Include the UI overlay -->
    <div id="game-ui-overlay"></div>

    <script>
        // Mock game scene with bunker residents
        const mockGameScene = {
            bunkerResidents: [
                {
                    id: 1,
                    name: 'Алексей Петров',
                    age: 32,
                    gender: 'М',
                    profession: 'инженер',
                    status: 'работает',
                    hunger: 85,
                    thirst: 90,
                    energy: 75,
                    health: 100,
                    skills: [
                        { text: 'трудолюбивый', positive: true },
                        { text: 'гений', positive: true }
                    ],
                    itemsText: 'Инструменты, запчасти',
                    admittedAt: 1
                },
                {
                    id: 2,
                    name: 'Мария Иванова',
                    age: 28,
                    gender: 'Ж',
                    profession: 'доктор',
                    status: 'отдыхает',
                    hunger: 95,
                    thirst: 88,
                    energy: 60,
                    health: 95,
                    skills: [
                        { text: 'трудолюбивый', positive: true }
                    ],
                    itemsText: 'Медикаменты, аптечка',
                    admittedAt: 1
                },
                {
                    id: 3,
                    name: 'Дмитрий Сидоров',
                    age: 45,
                    gender: 'М',
                    profession: 'охотник',
                    status: 'работает',
                    hunger: 70,
                    thirst: 75,
                    energy: 80,
                    health: 65,
                    skills: [
                        { text: 'сильный', positive: true }
                    ],
                    itemsText: 'Ружьё, патроны',
                    admittedAt: 2
                }
            ],
            getCurrentResidentsData: function() {
                console.log('Mock getCurrentResidentsData called');
                return this.bunkerResidents.map((resident, index) => ({
                    id: resident.id,
                    index: index,
                    name: resident.name,
                    age: resident.age,
                    gender: resident.gender,
                    profession: resident.profession,
                    status: resident.status || 'Отдыхает',
                    hunger: resident.hunger || 100,
                    thirst: resident.thirst || 100,
                    energy: resident.energy || 100,
                    health: resident.health || 100,
                    skills: resident.skills || [],
                    itemsText: resident.itemsText || 'Нет предметов',
                    admittedAt: resident.admittedAt,
                    patient: resident.patient || false,
                    isEnemy: false
                }));
            },
            getResidentById: function(id) {
                console.log('Mock getResidentById called for ID:', id);
                const resident = this.bunkerResidents.find(r => r.id === id);
                if (resident) {
                    return {
                        id: resident.id,
                        name: resident.name,
                        age: resident.age,
                        gender: resident.gender,
                        profession: resident.profession,
                        status: resident.status || 'Отдыхает',
                        hunger: resident.hunger || 100,
                        thirst: resident.thirst || 100,
                        energy: resident.energy || 100,
                        health: resident.health || 100,
                        skills: resident.skills || [],
                        itemsText: resident.itemsText || 'Нет предметов',
                        admittedAt: resident.admittedAt,
                        patient: resident.patient || false,
                        isEnemy: false
                    };
                }
                return null;
            }
        };

        let statusElement = document.getElementById('status');

        function updateStatus(message) {
            statusElement.textContent = 'Status: ' + message;
            console.log('[Test]', message);
        }

        function testSimpleList() {
            const list = document.getElementById('simple-list');
            const items = document.getElementById('simple-items');

            items.innerHTML = '';

            mockGameScene.bunkerResidents.forEach((resident, index) => {
                const item = document.createElement('div');
                item.className = 'simple-item';
                item.innerHTML = `
                    <div class="simple-name">${resident.name}</div>
                    <div class="simple-profession">${resident.profession}</div>
                `;
                item.onclick = () => console.log('Clicked on:', resident.name);
                items.appendChild(item);
            });

            list.style.display = 'block';
            updateStatus('Simple list displayed');
        }

        // Load UI overlay
        document.addEventListener('DOMContentLoaded', function() {
            fetch('./src/ui/game-overlay.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('game-ui-overlay').innerHTML = html;
                    updateStatus('UI overlay loaded successfully');

                    // Initialize global functions after loading
                    setTimeout(() => {
                        updateStatus('Functions initialized');
                    }, 500);
                })
                .catch(error => {
                    updateStatus('Failed to load UI overlay: ' + error.message);
                });
        });

        function testOpenResidents() {
            updateStatus('Testing openResidents...');

            // Mock window.game object
            window.game = {
                scene: {
                    getScene: function() {
                        return mockGameScene;
                    }
                }
            };

            if (typeof openResidents === 'function') {
                openResidents();
                updateStatus('openResidents executed successfully');
            } else {
                updateStatus('openResidents function not found');
            }
        }

        function testOpenResidentDetail() {
            updateStatus('Testing resident detail...');

            // First populate with mock data
            window.currentResidentsData = mockGameScene.getCurrentResidentsData();

            if (typeof openResidentDetail === 'function') {
                openResidentDetail(0); // Show first resident
                updateStatus('openResidentDetail executed successfully');
            } else {
                updateStatus('openResidentDetail function not found');
            }
        }

        function closeAllModals() {
            const modals = ['population-modal', 'resident-detail-modal'];
            modals.forEach(modalId => {
                if (typeof closeModal === 'function') {
                    closeModal(modalId);
                }
            });
            updateStatus('All modals closed');
        }

        console.log('Updated residents test page loaded');
        console.log('Mock residents:', mockGameScene.bunkerResidents);
    </script>
</body>
</html>
