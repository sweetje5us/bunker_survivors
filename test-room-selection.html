<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –∫–æ–º–Ω–∞—Ç - Bunker Survivors</title>
    <style>
        body {
            font-family: 'Press Start 2P', monospace;
            background: #0e1116;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .test-btn {
            background: #1a1d22;
            border: 2px solid #4fc3f7;
            color: #4fc3f7;
            padding: 10px 20px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            background: #4fc3f7;
            color: #0e1116;
        }
        
        .test-info {
            background: #1a1d22;
            border: 2px solid #555;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-info h3 {
            color: #4fc3f7;
            margin-top: 0;
        }
        
        .test-info ul {
            text-align: left;
            line-height: 1.6;
        }
        
        .test-info li {
            margin-bottom: 8px;
        }
        
        #status {
            background: #2a2a2a;
            border: 1px solid #555;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß± –¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –∫–æ–º–Ω–∞—Ç</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTML –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–º–Ω–∞—Ç</p>
        </div>

        <div class="test-info">
            <h3>üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º:</h3>
            <ul>
                <li>‚úÖ HTML –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∫–æ–º–Ω–∞—Ç</li>
                <li>‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç</li>
                <li>‚úÖ –í—ã–±–æ—Ä –∫–æ–º–Ω–∞—Ç—ã –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞</li>
                <li>‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Phaser —á–µ—Ä–µ–∑ GameScene</li>
                <li>‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</li>
            </ul>
        </div>

        <div class="test-buttons">
            <button class="test-btn" onclick="testRoomSelection()">üè† –û—Ç–∫—Ä—ã—Ç—å –≤—ã–±–æ—Ä –∫–æ–º–Ω–∞—Ç</button>
            <button class="test-btn" onclick="testRoomClick()">üñ±Ô∏è –¢–µ—Å—Ç –∫–ª–∏–∫–∞ –ø–æ –∫–æ–º–Ω–∞—Ç–µ</button>
            <button class="test-btn" onclick="testModalClose()">‚ùå –¢–µ—Å—Ç –∑–∞–∫—Ä—ã—Ç–∏—è</button>
            <button class="test-btn" onclick="testResponsive()">üì± –¢–µ—Å—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏</button>
        </div>

        <div id="status">Status: Ready</div>
    </div>

    <!-- Include the UI overlay -->
    <div id="game-ui-overlay"></div>

    <script>
        let statusElement = document.getElementById('status');

        function updateStatus(message) {
            statusElement.textContent = 'Status: ' + message;
            console.log('[Test]', message);
        }

        function testRoomSelection() {
            updateStatus('Testing room selection modal...');
            
            if (typeof window.populateRoomSelectionModal === 'function') {
                // Simulate opening room selection modal
                const roomModal = document.getElementById('room-selection-modal');
                if (roomModal) {
                    roomModal.style.display = 'block';
                    
                    // Populate with room data
                    window.populateRoomSelectionModal();
                    
                    updateStatus('Room selection modal opened successfully');
                } else {
                    updateStatus('Room selection modal not found');
                }
            } else {
                updateStatus('populateRoomSelectionModal function not found');
            }
        }

        function testRoomClick() {
            updateStatus('Testing room click functionality...');
            
            // Simulate clicking on a room option
            const roomOption = document.querySelector('.room-option');
            if (roomOption) {
                roomOption.click();
                updateStatus('Room click test completed');
            } else {
                updateStatus('No room options found for testing');
            }
        }

        function testModalClose() {
            updateStatus('Testing modal close functionality...');
            
            // Simulate closing the modal
            if (typeof window.closeModal === 'function') {
                window.closeModal('room-selection-modal');
                updateStatus('Modal close test completed');
            } else {
                updateStatus('closeModal function not found');
            }
        }

        function testResponsive() {
            updateStatus('Testing responsive design...');
            
            // Simulate mobile viewport
            const originalWidth = window.innerWidth;
            const originalHeight = window.innerHeight;
            
            // Set mobile dimensions
            Object.defineProperty(window, 'innerWidth', {
                writable: true,
                configurable: true,
                value: 375
            });
            Object.defineProperty(window, 'innerHeight', {
                writable: true,
                configurable: true,
                value: 667
            });
            
            // Trigger resize event
            window.dispatchEvent(new Event('resize'));
            
            updateStatus('Mobile viewport simulated, check layout');
            
            // Restore original dimensions after 3 seconds
            setTimeout(() => {
                Object.defineProperty(window, 'innerWidth', {
                    writable: true,
                    configurable: true,
                    value: originalWidth
                });
                Object.defineProperty(window, 'innerHeight', {
                    writable: true,
                    configurable: true,
                    value: originalHeight
                });
                window.dispatchEvent(new Event('resize'));
                updateStatus('Original viewport restored');
            }, 3000);
        }

        // Mock game object for testing
        window.game = {
            scene: {
                getScene: (name) => {
                    if (name === 'GameScene') {
                        return {
                            simpleBunker: {
                                setSelectedRoomType: (roomId) => {
                                    updateStatus(`Room type selected in bunkerView: ${roomId}`);
                                    console.log('Room type selected in bunkerView:', roomId);
                                }
                            },
                            selectRoomTypeForPlacement: (roomId) => {
                                updateStatus(`Room type selected: ${roomId}`);
                                console.log('Room type selected:', roomId);
                            }
                        };
                    }
                    return null;
                }
            }
        };
        
        // Mock populateRoomSelectionModal for testing
        window.populateRoomSelectionModal = function(gameScene) {
            console.log('[Test] populateRoomSelectionModal called with gameScene:', !!gameScene);
            window.currentGameScene = gameScene;
            
            const roomSelectionGrid = document.querySelector('.room-selection-grid');
            if (!roomSelectionGrid) return;
            
            // Clear existing content
            roomSelectionGrid.innerHTML = '';
            
            // Create test room options
            const testRooms = [
                { id: '–°–ø–∞–ª—å–Ω—è', name: '–°–ø–∞–ª—å–Ω—è', description: '–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞', icon: 'üõèÔ∏è', cost: '100 –º–æ–Ω–µ—Ç' },
                { id: '–°—Ç–æ–ª–æ–≤–∞—è', name: '–°—Ç–æ–ª–æ–≤–∞—è', description: '–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞', icon: 'üçΩÔ∏è', cost: '150 –º–æ–Ω–µ—Ç' }
            ];
            
            testRooms.forEach(room => {
                const roomOption = document.createElement('div');
                roomOption.className = 'room-option';
                roomOption.dataset.roomId = room.id;
                
                roomOption.innerHTML = `
                    <div class="room-icon">${room.icon}</div>
                    <div class="room-name">${room.name}</div>
                    <div class="room-description">${room.description}</div>
                    <div class="room-cost">${room.cost}</div>
                `;
                
                roomOption.addEventListener('click', () => {
                    console.log('[Test] Room clicked:', room.id);
                    updateStatus(`Room selected: ${room.id}`);
                    
                    if (window.currentGameScene) {
                        console.log('[Test] Calling setSelectedRoomType');
                        if (window.currentGameScene.simpleBunker && typeof window.currentGameScene.simpleBunker.setSelectedRoomType === 'function') {
                            window.currentGameScene.simpleBunker.setSelectedRoomType(room.id);
                        }
                    }
                    
                    closeModal('room-selection-modal');
                });
                
                roomSelectionGrid.appendChild(roomOption);
            });
        };

        // Mock UI functions
        window.openModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
                updateStatus(`Modal opened: ${modalId}`);
            }
        };

        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                updateStatus(`Modal closed: ${modalId}`);
            }
        };

        // Load the UI overlay
        window.addEventListener('load', () => {
            updateStatus('Test page loaded, ready for testing');
            
            // Load game-overlay.html content
            fetch('src/ui/game-overlay.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('game-ui-overlay').innerHTML = html;
                    updateStatus('UI overlay loaded successfully');
                })
                .catch(error => {
                    updateStatus('Error loading UI overlay: ' + error.message);
                });
        });
    </script>
</body>
</html>
